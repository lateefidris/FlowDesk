<%# Initialize a hash to count occurrences of each service_id %>
<% service_counts = current_user.desks.bookings.each_with_object(Hash.new(0)) do |booking, counts| %>
  <% counts[booking.service_id] += 1 %>
<% end %>

<%# Sort service_ids by their frequency and limit to the top 5 %>
<% sorted_service_ids = service_counts.sort_by { |_, count| -count }.map(&:first).first(5) %>

<% counter = 1 %>
<%# Collect and display each Service object in order %>
<% sorted_service_ids.each_with_index do |service_id, index| %>
  <% service = Service.find(service_id) %>

  <div class="flex items-center bg-primary text-white p-4 m-3">
    <span class="text-4xl font-bold pr-4 border-r">
      <%= index + 1 %>
    </span>
    <div class="flex flex-row flex-grow pl-4 justify-between">
      <h3 class="font-light flex items-center uppercase text-l hover:font-bold">
        <%= service.name %>
      </h3>
      <div id="block" class="flex">
        <div class="text-lg bg-white text-secondary rounded px-3 py-1">
          <span class="font-bold">
            <%= service_counts[service_id] %>
          </span>
          BOOKINGS
        </div>
      </div>
    </div>
  </div>

<% end %>


<h1 class="text-5xl text-center font-black text-accent"><%= current_user.desks.bookings.count %></h1>
<h2 class="text-center uppercase font-bold text-white">Total bookings</h2>

<h1 class="text-4xl text-center font-black text-accent">
  <% total_revenue = 0 %>
  <% current_user.desks.bookings.completed.each do |booking| %>
    <% if booking.service %>
      <% total_revenue += booking.service.price %>
    <% end %>
  <% end %>
  <%= number_to_currency(total_revenue) %>
</h1>
<h2 class="text-center uppercase font-bold text-white pb-5">Total Revenue</h2>
